<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="x-ua-compatible" content="ie=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Who’s On First | Docs | Processes and Workflows | San Francisco Neighbourhood Updates</title>
		<meta name="description" content="Who’s on First is a gazetteer of places." />
		<link rel="apple-touch-icon" href="/images/favicons/apple-touch-icon.png" sizes="180x180">
		<link rel="icon" type="image/png" href="/images/favicons/favicon-16x16.png" sizes="16x16">
		<link rel="icon" type="image/png" href="/images/favicons/favicon-32x32.png" sizes="32x32">
		<link rel="manifest" href="/images/favicons/manifest.json">
		<link rel="mask-icon" href="/images/favicons/safari-pinned-tab.svg" color="#2C1E3F">
		<link rel="stylesheet" href="/css/bootstrap.min.css">
		<link rel="stylesheet" href="/css/mapzen.whosonfirst.css">
		<!-- CSS for code styling from highlightpack.js -->
		<link rel="stylesheet" href="/css/styles/grayscale.css">
	</head>
	<body>
		<div class="whosonfirst-wrapper">

			<nav class="navbar navbar-default navbar-fixed-top whosonfirst-fixed-subpage-navbar">
				<div class="container">

					<!-- Brand and toggle get grouped for better mobile display -->
					<div class="navbar-header">
						<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
							<span class="sr-only">Toggle navigation</span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
						</button>
						<a class="navbar-brand" href="/">Who’s On First</a>
					</div>

					<!-- Collect the nav links, forms, and other content for toggling -->
					<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
					  <ul class="nav navbar-nav navbar-right">

							<li class="whosonfirst-navbar-element-collapsed">
								<a href="/browse/" class="whosonfirst-nav-link whosonfirst-nav-link-collapsed">browse</a>
							</li>
					    
							<li class="whosonfirst-navbar-element-collapsed">
								<a href="/docs/" class="whosonfirst-nav-link whosonfirst-nav-link-collapsed">documentation</a>
							</li>
							
							<li class="whosonfirst-navbar-element-collapsed">
								<a href="/code/" class="whosonfirst-nav-link whosonfirst-nav-link-collapsed">code</a>
							</li>

							<!--
							<li class="whosonfirst-navbar-element-collapsed">
								<a href="/api/" class="whosonfirst-nav-link whosonfirst-nav-link-collapsed">api</a>
							</li>
							-->
							
							<li class="whosonfirst-navbar-element-collapsed">
								<a href="/download/" class="whosonfirst-nav-link whosonfirst-nav-link-collapsed">download</a>
							</li>
							
							<li class="whosonfirst-navbar-element-collapsed">
								<a href="/blog/" class="whosonfirst-nav-link whosonfirst-nav-link-collapsed">blog</a>
							</li>
						</ul>
					</div>
				</div>
			</nav>
<li class="whosonfirst-sidenav-list-element whosonfirst-sidenav-list-element-secondlevel whosonfirst-sidenav-link-twoliner-container">
	<a href="/docs/processes/cessation-deprecation/" class="whosonfirst-nav-link whosonfirst-sidenav-link-twoliner whosonfirst-sidenav-link">cessation and deprecation</a>
</li>
<li class="whosonfirst-sidenav-list-element whosonfirst-sidenav-list-element-secondlevel whosonfirst-sidenav-link-twoliner-container">
	<a href="/docs/processes/significant-event/" class="whosonfirst-nav-link whosonfirst-sidenav-link-twoliner whosonfirst-sidenav-link">what is a significant event</a>
</li>
<li class="whosonfirst-sidenav-list-element whosonfirst-sidenav-list-element-secondlevel">
	<a href="/docs/processes/wof-life-cycle/" class="whosonfirst-nav-link whosonfirst-sidenav-link">wof life cycle</a>
</li>
<li class="whosonfirst-sidenav-list-element whosonfirst-sidenav-list-element-secondlevel whosonfirst-sidenav-link-twoliner-container">
	<a href="/docs/processes/s3-import/" class="whosonfirst-nav-link whosonfirst-sidenav-link-twoliner whosonfirst-sidenav-link">s3 import requirements</a>
</li>
<li class="whosonfirst-sidenav-list-element whosonfirst-sidenav-list-element-secondlevel whosonfirst-sidenav-link-twoliner-container">
	<a href="/docs/processes/seattle-neighbourhoods/" class="whosonfirst-nav-link whosonfirst-sidenav-link-twoliner whosonfirst-sidenav-link">seattle neighbourhoods</a>
</li>
<li class="whosonfirst-sidenav-list-element whosonfirst-sidenav-list-element-secondlevel whosonfirst-sidenav-link-twoliner-container">
	<a href="/docs/processes/san-francisco-neighbourhoods/" class="whosonfirst-nav-link whosonfirst-sidenav-link-twoliner whosonfirst-sidenav-link whosonfirst-nav-active">san francisco neighbourhoods</a>
</li>
<li class="whosonfirst-sidenav-list-element whosonfirst-sidenav-list-element-secondlevel whosonfirst-sidenav-link-twoliner-container">
	<a href="/docs/processes/wikipedia-concordances/" class="whosonfirst-nav-link whosonfirst-sidenav-link-twoliner whosonfirst-sidenav-link">wikipedia concordances</a>
</li>
<h1 class="whosonfirst-subpage-header">
Updating Who&#39;s On First Neighbourhood Records (part one)
Updating Who&#39;s On First Neighbourhood Records (part one)
</h1>
<div class="whosonfirst-fulltabs-container">
	<div class="whosonfirst-extrasmall-tabs-menu">
		<div class="whosonfirst-extrasmall-tabs-menu-content">
			<div class="whosonfirst-extrasmall-tabs-menu-content-header">
				<div class="row whosonfirst-extrasmall-menu-row">
					<div class="col-xs-11">
						<div class="whosonfirst-extrasmall-tab-selection">San Francisco Neighbourhood Updates</div>
					</div>
					<div class="col-xs-1 whosonfirst-extrasmall-menu-chevron-col">
						<button type="button" class="navbar-toggle collapsed whosonfirst-extrasmall-menu-chevron-down" data-toggle="collapse" data-target="#bs-example-navbar-collapse-2" aria-expanded="false">
							<span id="glyphicon-one" class="glyphicon glyphicon-menu-down whosonfirst-extrasmall-menu-actual-chevron-down"></span>
						</button>
					</div>
				</div>
			</div>
			<div class="collapse" id="bs-example-navbar-collapse-2">
				<div class="whosonfirst-extrasmall-nav-collection">
				</div>
			</div><!-- /.navbar-collapse -->
		</div>
	</div>
	<div class="whosonfirst-tabs-content">
<li class="whosonfirst-navbar-element-collapsed whosonfirst-extrasmall-nav-element whosonfirst-smallnav-link-twoliner-container">
	<a href="/docs/processes/cessation-deprecation/" class="whosonfirst-nav-link whosonfirst-subnav-secondlevel whosonfirst-smallnav-link-twoliner whosonfirst-extrasmall-nav-link-collapsed">cessation and deprecation</a>
</li>
<li class="whosonfirst-navbar-element-collapsed whosonfirst-extrasmall-nav-element">
	<a href="/docs/processes/significant-event/" class="whosonfirst-nav-link whosonfirst-subnav-secondlevel whosonfirst-extrasmall-nav-link-collapsed">what is a significant event</a>
</li>
<li class="whosonfirst-navbar-element-collapsed whosonfirst-extrasmall-nav-element">
	<a href="/docs/processes/wof-life-cycle/" class="whosonfirst-nav-link whosonfirst-subnav-secondlevel whosonfirst-extrasmall-nav-link-collapsed">wof life cycle</a>
</li>
<li class="whosonfirst-navbar-element-collapsed whosonfirst-extrasmall-nav-element whosonfirst-smallnav-link-twoliner-container">
	<a href="/docs/processes/s3-import/" class="whosonfirst-nav-link whosonfirst-subnav-secondlevel whosonfirst-smallnav-link-twoliner whosonfirst-extrasmall-nav-link-collapsed">s3 import requirements</a>
</li>
<li class="whosonfirst-navbar-element-collapsed whosonfirst-extrasmall-nav-element whosonfirst-smallnav-link-twoliner-container">
	<a href="/docs/processes/seattle-neighbourhoods/" class="whosonfirst-nav-link whosonfirst-subnav-secondlevel whosonfirst-smallnav-link-twoliner whosonfirst-extrasmall-nav-link-collapsed">seattle neighbourhoods</a>
</li>
<li class="whosonfirst-navbar-element-collapsed whosonfirst-extrasmall-nav-element whosonfirst-smallnav-link-twoliner-container">
	<a href="/docs/processes/san-francisco-neighbourhoods/" class="whosonfirst-nav-link whosonfirst-subnav-secondlevel whosonfirst-smallnav-link-twoliner whosonfirst-extrasmall-nav-link-collapsed whosonfirst-nav-active">san francisco neighbourhoods</a>
</li>
<li class="whosonfirst-navbar-element-collapsed whosonfirst-extrasmall-nav-element">
	<a href="/docs/processes/wikipedia-concordances/" class="whosonfirst-nav-link whosonfirst-subnav-secondlevel whosonfirst-extrasmall-nav-link-collapsed">wikipedia concordances</a>
</li>
<!-- https://github.com/whosonfirst/whosonfirst-cookbook/blob/master/issue_workflows/sf_neighbourhood_updates_pt_1.md -->
 <p>The <a href="https://whosonfirst.mapzen.com/">Who's On First</a> (WOF) project is not pretending to be the authority of truth, but rather a home for data from various sources and a project that we hope generates discussion. The WOF gazetteer houses data for many geographies, including counties (which parent cities) and cities (which parent microhoods, neighbourhoods, and macrohoods). Neighbourhoods are the places where we live and work in cities; <em>the more neighbourhood data, the better.</em></p> <p><a href="https://camo.githubusercontent.com/a64c3504cd94e619873f2c487faf57c9446f4ec4/68747470733a2f2f6d61707a656e2d6173736574732e73332e616d617a6f6e6177732e636f6d2f696d616765732f73662d6e65696768626f7572686f6f642d757064617465732f312e6a7067" target="_blank"><img src="https://camo.githubusercontent.com/a64c3504cd94e619873f2c487faf57c9446f4ec4/68747470733a2f2f6d61707a656e2d6173736574732e73332e616d617a6f6e6177732e636f6d2f696d616765732f73662d6e65696768626f7572686f6f642d757064617465732f312e6a7067" alt="San Francisco, CA" data-canonical-src="https://mapzen-assets.s3.amazonaws.com/images/sf-neighbourhood-updates/1.jpg" style="max-width:100%;"></a> <em>Photo Credit: <a href="https://www.flickr.com/photos/photographingtravis/15876578760/in/photolist-qbXBJy-wS7pFF-2XzRnL-HbtCbX-rbmAJj-7dPz43-9Py6me-hEkAuS-8gihrC-8BCzsr-uVZPsT-92LBPi-Ecaiho-HDBW9C-7dPw9s-exakrT-dNzgiu-aJaiTz-nK4F3y-FtbMW-bywi7N-hzeCpW-8HXuPC-jeVkWQ-uiA2S7-pzMxbL-bjH5AC-bsyv8U-keLDPc-gWDhS-xadSek-nQz7At-brj2fe-wuPTK4-4856y6-pdYCPT-wSCsAz-FtesM-7j84Hs-dqBe97-5RT97n-fzhNSx-4heGvv-fKii4T-nqgSDG-xpnL1d-dHcAn7-pQYC72-9wduZD-wuF3bm_">Travis Wise, Flickr</a></em></p> <p><strong>Our Audience:</strong> Those who care about neighbourhoods and have a few hours to a few days to spend diving into QGIS.</p> <p><strong>Your Skills/Experience:</strong> This tutorial was written with the intermediate to advanced GIS user. While this tutorial tries to explain the editing process in detail, some information may not be immediately clear to a beginning user.</p> <p><strong>Why are neighbourhoods important to mapping?</strong></p> <ul> <li><strong>Labelling.</strong> When we use a mapping application, we want neighbourhoods to be labeled on the map (in the right place and at the right zoom).</li> <li><strong>Ability to search.</strong> Neighbourhoods should be searchable (with the ability to know how large the feature is and fit it into view).</li> <li><strong>Browsing venues.</strong> We should be able to browse venues by neighbourhood.</li> </ul> <p>It is important to understand where <a href="https://github.com/whosonfirst/whosonfirst-placetypes">placetypes</a> fall within the WOF hierarchy. Neighbourhoods, macrohoods, and microhoods are described below:</p> <ul> <li><strong>Neighbourhoods:</strong> A centralized community within a larger city, town, or borough.</li> <li><strong>Macrohoods:</strong> A grouping of neighbourhoods within a larger city, town, or borough.</li> <li><strong>Microhoods:</strong> A geographically localized sub-section of a neighbourhood.</li> </ul> <p>This tutorial addresses the issues we found with San Francisco's neighbourhoods and describes the workflow we took in fixing them. In the end, we hope you can follow along and edit neighbourhoods for your own city!</p> <p><strong>What are your options when updating neighbourhoods?</strong></p> <ul> <li>Notice just one neighbourhood that needs cleaning up? File a <a href="https://github.com/whosonfirst/whosonfirst-data/issues/new">Github issue</a>, or <a href="mailto:stephen.epps@mapzen.com">email us</a>. <em>[See something, say something.]</em></li> <li>Notice an open dataset of administrative data? Open an <a href="https://github.com/whosonfirst/whosonfirst-data/issues/new">issue</a> in our WOF repository.</li> <li>Still interested but confused about all this Github and WOF-isms? We can send you a "starter kit" that includes your requested neighbourhoods. <a href="mailto:stephen.epps@mapzen.com">Email us</a>.</li> <li>Follow the instructions below and send us a <a href="https://github.com/whosonfirst/whosonfirst-data/pulls">pull request</a>.</li> </ul> <p><strong>Key terms:</strong></p> <p>Check out <a href="https://github.com/whosonfirst/whosonfirst-cookbook/blob/master/definition/key_terms.md">these key terms</a> if you have any questions about the vocabulary used in this guide.</p> <h2 id="the-issue">The Issue</h2> <p>We received a <a href="https://github.com/whosonfirst/whosonfirst-data/issues/125">report</a> in the <a href="https://github.com/whosonfirst/whosonfirst-data">whosonfirst-data repository</a> that the shape of San Francisco’s Golden Gate Park neighbourhood was both too small and extended into adjacent neighbourhoods. While researching online sources for a better shape, we noticed that most adjacent neighbourhood shapes in WOF could also be improved to align better with the road network and local expectations. After researching neighbourhood shapes online, we downloaded neighbourhood shapes for San Francisco from <a href="https://data.sfgov.org/">SF OpenData</a>, a city data website, to compare with the neighbourhood records in our WOF repository. We then filed a <a href="https://github.com/whosonfirst/whosonfirst-data/issues/316">new issue</a> to handle all neighbourhood updates for San Francisco.</p> <p>Typically, Who’s On First sources <a href="http://www.quattroshapes.com">Quattroshapes</a> geometries for most neighbourhoods around the globe. However, many neighbourhoods in the United States, including San Francisco, source their default geometry from <a href="http://www.zetashapes.com">Zetashapes</a>. The Zetashapes project follows the same basic principles as Quattroshapes, but builds shapes up from Census 2010 features and can draw shapes that are too big, small, or <em>just plain weird</em>. We’ve seen problems with shapes extending in the water and far out into neighboring rural areas. This technique is responsible for the issues that we are correcting in San Francisco.</p> <p>Drawing neighbourhood shapes is a tricky business. Strangers generally agree on what a neighbourhood is named and its rough shape, but even good friends can argue vehemently about where one neighbourhood ends and another begins - even if there are hard edges between neighbourhoods or they should overlap. Recognizing this, Who’s On First allows multiple alternate geometries for a place, but for practical reasons we need to set just one shape as the default geometry.</p> <p><strong>To clean up our neighbourhood geometries, we needed to take five steps:</strong></p> <ul> <li><strong>#1</strong> <em>Review WOF records for your locality. Get a sense of where they could be improved and where they are acceptable, focusing on names and shapes.</em></li> <li><strong>#2</strong> <em>Research other neighbourhood sources on the internet.</em></li> <li><strong>#3</strong> <em>Download authoritative neighbourhood geometries from a reliable, open license data source for your locality.</em></li> <li><strong>#4</strong> <em>Reconciling our data sources. Things to think about: Is the number of neighbourhood records similar? Are the shapes similar or better? Could you draw your own shapes?</em></li> <li><strong>#5</strong> <em>Update records, either though a clean import or creating a new hybrid using the best of both (and your local knowledge).</em></li> </ul> <p>While specifics listed in this tutorial may reference San Francisco, our hope is that you will be able to follow along with these steps to update the neighbourhood records in your locality.</p> <h2 id="1-review-whos-on-first-records-for-your-locality">1: Review Who's On First records for your locality</h2> <p>In this section, you will either:</p> <ul> <li>Use the handy <a href="https://whosonfirst.mapzen.com/spelunker/download/85688637/?exclude=nullisland#5/37.419/-119.307">Bundler Tool</a> (this example link points to descendants of California) to gather a collection of neighbourhood features in your given locality</li> </ul> <p><strong>OR</strong></p> <ul> <li>Use the <code>git checkout</code> command in your terminal to <strong>clone necessary repositories</strong></li> <li><strong>Collect</strong> a .geojson file for all neighbourhoods in your locality (city)</li> <li>Add your .geojson file to a QGIS document for <strong>review</strong></li> </ul> <p>The Bundler Tool quickly gathers a collection of descendant records in GeoJSON format given your the parent record's ID. Simply click the "Download Descendants" link on any record's page in the Spelunker.</p> <p>This is the "quick and easy" method to gathering neighbourhood records, however, this tool only gathers up to 500 WOF records. For larger queries or markets, you will need to clone necessary repositories and collect a .geojson file. Instructions below:</p> <ul> <li>Ensure that you have the most recent software packages. Windows users should have Powershell 3.0 before beginning any GitHub work from the terminal. A Powershell 3.0 download can be found <a href="https://www.microsoft.com/en-us/download/details.aspx?id=34595">here</a>. Additionally, all users should ensure they have <code>setuptools</code> for Python by <a href="https://pypi.python.org/pypi/setuptools">downloading</a> Python 2.7 (or a more current version) and <code>GDAL 2.1</code> by <a href="http://www.qgis.org/en/site/">downloading</a> QGIS 2.14 (or a more current version).</li> <li>Run <code>git checkout</code> on the <a href="https://github.com/whosonfirst/whosonfirst-data">WOF Data repository</a>, <a href="https://github.com/whosonfirst/whosonfirst-properties">WOF Properties repository</a>, and <a href="https://github.com/whosonfirst/py-mapzen-whosonfirst-utils">WOF Utils repository</a>.</li> <li>Run the <code>install</code> script in whosonfirst-utils repository.</li> <li>Open the <code>WOF-csv-to-feature-collection.py</code> script in your <code>Utils</code> repo. Update line 63 with your local filepath.</li> </ul> <p>Once complete, entering the following string in the terminal from the whosonfirst-utils repository's <code>scripts</code> folder allows us to collect San Francisco's neighbourhoods as a single .geojson file (updating filepaths of your local machine accordingly):</p> <blockquote> <p><em>python WOF-csv-to-feature-collection -p /usr/local/mapzen/whosonfirst-data/data -c /usr/local/mapzen/whosonfirst-data/meta/WOF-neighbourhood-latest.csv --aliases /usr/local/mapzen/whosonfirst-properties/aliases/property_aliases.json -o ~/Desktop/SF_Neighbourhoods.geojson --slim --slim-template external_editor -f 85922583</em></p> </blockquote> <p><a href="https://camo.githubusercontent.com/7ab32c9ad12b117b82ca4139be9ea4802c8034e5/68747470733a2f2f6d61707a656e2d6173736574732e73332e616d617a6f6e6177732e636f6d2f696d616765732f73662d6e65696768626f7572686f6f642d757064617465732f7465726d696e616c5f636f6d6d616e642e706e67" target="_blank"><img width="600" alt="San Francisco neighbourhood records in WOF" src="https://camo.githubusercontent.com/7ab32c9ad12b117b82ca4139be9ea4802c8034e5/68747470733a2f2f6d61707a656e2d6173736574732e73332e616d617a6f6e6177732e636f6d2f696d616765732f73662d6e65696768626f7572686f6f642d757064617465732f7465726d696e616c5f636f6d6d616e642e706e67" data-canonical-src="https://mapzen-assets.s3.amazonaws.com/images/sf-neighbourhood-updates/terminal_command.png" style="max-width:100%;"></a></p> <p><em>Image: Data collection script in the terminal.</em></p> <p><em>Note: The trailing number <code>85922583</code> at the end of this script is the WOF ID for <a href="https://whosonfirst.mapzen.com/spelunker/id/85922583/#10/37.7850/-122.7278">San Francisco</a>. When running this script, make sure to update that ID with whatever record you need neighbourhood geometries for. An ID is a unique identifier for records in WOF. Each record in WOF has an ID. To find the ID for your city, search the <a href="https://whosonfirst.mapzen.com/spelunker">Spelunker</a> and copy the ID.</em></p> <p><strong>Voilà!</strong> We have a .geojson of WOF neighbourhood records in San Francisco! By changing the trailing ID (explained below), you can collect neighbourhood records for your own locality (city).</p> <p>To better understand what we're requesting of our command, here is a breakdown of exactly what is included:</p> <ul> <li><strong><code>python</code></strong>  Used to invoke python</li> <li><strong><code>WOF-csv-to-feature-collection</code></strong>  The python script that collects WOF records.</li> <li><strong><code>-p /PATH/whosonfirst-data/data</code></strong> sets the path to the local copy of all the WOF data. You will need to update this PATH depending on where you checked the file out.</li> <li><strong><code>-c /PATH/whosonfirst-data/meta/WOF-neighbourhood-latest.csv</code></strong> The metafile for the placetype you are interested in - neighbourhood. You will need to update this PATH depending on where you checked the file out.</li> <li><strong><code>--aliases /usr/local/mapzen/whosonfirst-properties/aliases/property_aliases.json</code></strong> Pulling in various aliases for attribute fields for your output file.</li> <li><strong><code>-o ~/Desktop/SFNeighbourhoods.geojson</code></strong> Your output file.</li> <li><strong><code>--slim</code></strong> Option parser to limit property export to subset (roughly those in the CSV file) and reduce file size.</li> <li><strong><code>--slim-template</code></strong> Option parser to trim key names to fit Esri Shapefile format (10 charachter length limit).</li> <li><strong><code>external_editor</code></strong> Return only necessary attribute fields for neighbourhood edits.</li> <li><strong><code>-f 85922583</code></strong> ID of the locality you need neighbourhood records for, found by searching our <a href="https://whosonfirst.mapzen.com/spelunker">Spelunker</a>.</li> </ul> <p><strong>About the <code>external_editor</code> option:</strong></p> <ul> <li> <p>This option was created for our neighbourhood editors and exports only relevant and required record attributes for WOF neighbourhood records. All required attributes (and applicable optional attributes) should be included when filing your PR of updated neighbourhood records. The <code>external_editor</code> attribute fields include:</p> </li> <li> <p><strong>'name'</strong> The attribute that will be used for the <code>wof:name</code> field. Required for all files.</p> </li> <li> <p><strong>'id'</strong> The attribute that will be used for the <code>wof:id</code> field. Required for all files.</p> </li> <li> <p><strong>'placetype'</strong> The attribute that will be used for the <code>wof:placetype</code> field. Required for all files.</p> </li> <li> <p><strong>'parent_id'</strong> The attribute that will be used for the <code>wof:parent_id</code> field. Should equal the <code>wof:id</code> of the next placetype up in the feature's hierarchy. Required for all files.</p> </li> <li> <p><strong>'is_landuse_aoi'</strong> Used to signify an "area of interest" land use, different than the <code>wof:placetype</code> would suggest.</p> </li> <li> <p><strong>'supersedes'</strong> The attribute that will be used for the <code>wof:supersedes</code> field. Required for all files that supersede another WOF record.</p> </li> <li> <p><strong>'superseded_by'</strong> The attribute that will be used for the <code>wof:superseded_by</code> field. Required for all files that are superseded by another WOF record.</p> </li> <li> <p><strong>'deprecated'</strong> The attribute that will be used for the <code>edtf:deprecated</code> field. A date field <em>(YYYY-MM-DD)</em> used to signify when we determined this record was "junk" and incorrect since inclusion in Who's On First. Required for all files that are deprecated. (see: <a href="https://github.com/whosonfirst/whosonfirst-cookbook/blob/master/definition/deprecated_vs_cessation.md">cessation vs. deprecated documentation</a>)</p> </li> <li> <p><strong>'cessation'</strong> The attribute that will be used for the <code>edtf:cessation</code> field. A date field <em>(YYYY-MM-DD)</em> used to signify when we determined this record was no longer valid in Who's On First (usually when it has been replaced by another record). Also requires a new field called <code>mz:is_current</code> to be created. The <code>mz:is_current</code> field value is '0' if the record has a <code>edtf:cessation</code> date. (see: <a href="https://github.com/whosonfirst/whosonfirst-cookbook/blob/master/definition/deprecated_vs_cessation.md">cessation vs. deprecated documentation</a>)</p> </li> <li> <p><strong>'eng_preferred_name'</strong> Preferred alternative names for a feature.</p> </li> <li> <p><strong>'eng_variant_name'</strong> Variant alternative names for a feature.</p> </li> <li> <p><strong>'max_zoom'</strong> Maximum zoom level at which feature labels appear on a map. Required for all new features to Who's On First.</p> </li> <li> <p><strong>'min_zoom'</strong> Minimum zoom level at which feature labels appear on a map. Required for all new features to Who's On First.</p> </li> <li> <p><strong>'lbl_latitude'</strong> A decimal value of a feature's Y coordinate. Value should be derived from <a href="https://github.com/mbloch/mapshaper">MapShaper</a> and included on any new shape imported to Who's On First. New X/Y coordinates attributes will be created when running a geojson or shapefile through the MapShaper tool. These new fields will be used for <code>lbl:latitude</code> and <code>lbl:longitude</code>. The MapShaper tool is also available via <a href="http://mapshaper.org/">http://mapshaper.org/</a>.</p> </li> <li> <p><strong>'lbl_longitude'</strong> A decimal value of a feature's X coordinate. Value should be derived from <a href="https://github.com/mbloch/mapshaper">MapShaper</a> and included on any new shape imported to Who's On First. New X/Y coordinates attributes will be created when running a geojson or shapefile through the MapShaper tool. These new fields will be used for <code>lbl:latitude</code> and <code>lbl:longitude</code>. The MapShaper tool is also available via <a href="http://mapshaper.org/">http://mapshaper.org/</a>.</p> </li> <li> <p><strong>'rev_lat'</strong> Equal to the <code>lbl_latitude</code> value. This field will be used to rebuild the feature's hierarchy.</p> </li> <li> <p><strong>'rev_long'</strong> Equal to the <code>lbl_longitude</code> value. This field will be used to rebuild the feature's hierarchy.</p> </li> <li> <p><strong>'is_funky'</strong> Optional.</p> </li> <li> <p><strong>'is_hard_boundary'</strong> Optional.</p> </li> <li> <p><strong>'is_official'</strong> Optional.</p> </li> <li> <p><strong>'tier_locality'</strong> Optional.</p> </li> <li> <p><strong>'country_id'</strong> The <code>wof:id</code> of the feature's parent country.</p> </li> <li> <p><strong>'region_id'</strong> The <code>wof:id</code> of the feature's parent region.</p> </li> <li> <p><strong>'locality_id'</strong> The <code>wof:id</code> of the feature's parent locality.</p> </li> <li> <p><strong>'WOF_country'</strong> Usually equal to the ISO code, this is a two-digit key representing the country your features are in. Required for all features.</p> </li> <li> <p><strong>'iso_country'</strong> Set by the <a href="http://www.iso.org/iso/home.html">Internation Organization for Standardization</a>, This is a two-digit key (listed <a href="https://en.wikipedia.org/wiki/ISO_3166-1">here</a>) representing the country your features are in. Required for all features.</p> </li> <li> <p><strong>'src_geom'</strong> Optional. Contains the source name of the feature's geometry. Given for research purposes.</p> </li> <li> <p><strong>'mz_note'</strong> Optional. Contains information about that given feature, if available.</p> </li> </ul> <p>From the WOF repository for San Francisco, a total of <strong>165</strong> (157 polygon geometries, 8 point geometries) records for neighbourhoods were collected using our <code>external_editor</code> option. QGIS was used to preview Who’s On First neighbourhood shapes (below).</p> <p><a href="https://camo.githubusercontent.com/49d5dd4e6e75c5f4bea63c1a897f811d352008a1/68747470733a2f2f6d61707a656e2d6173736574732e73332e616d617a6f6e6177732e636f6d2f696d616765732f73662d6e65696768626f7572686f6f642d757064617465732f6261795f6f76657276696577312e706e67" target="_blank"><img width="600" alt="San Francisco neighbourhood records in WOF" src="https://camo.githubusercontent.com/49d5dd4e6e75c5f4bea63c1a897f811d352008a1/68747470733a2f2f6d61707a656e2d6173736574732e73332e616d617a6f6e6177732e636f6d2f696d616765732f73662d6e65696768626f7572686f6f642d757064617465732f6261795f6f76657276696577312e706e67" data-canonical-src="https://mapzen-assets.s3.amazonaws.com/images/sf-neighbourhood-updates/bay_overview1.png" style="max-width:100%;"></a></p> <p><em>Image: San Francisco neighbourhood records (light purple) in comparison to the San Francisco Bay Area and the WOF shapes of San Francisco (blue).</em></p> <p>You might notice the general shape of San Francisco present in the photo below, but it's tough to make out. Many of these WOF neighbourhood shapes cross into what most people would consider a different neighbourhood, and, in two cases, include areas in different counties. The good news? The majority of these neighbourhood records contain usable information in their WOF attribute fields. Also, be mindful of the differences between single-part and multi-part polygon edits in QGIS. If your neighbourhood shapes are single-part polygons to begin with, you are unable to add a multi-part polygon into your feature collection.</p> <p><a href="https://camo.githubusercontent.com/fabff0217b29c685a58add090fe182e51bffa5f8/68747470733a2f2f6d61707a656e2d6173736574732e73332e616d617a6f6e6177732e636f6d2f696d616765732f73662d6e65696768626f7572686f6f642d757064617465732f6e65775f636f6e7469672e706e67" target="_blank"><img width="600" alt="San Francisco neighbourhood records in WOF" src="https://camo.githubusercontent.com/fabff0217b29c685a58add090fe182e51bffa5f8/68747470733a2f2f6d61707a656e2d6173736574732e73332e616d617a6f6e6177732e636f6d2f696d616765732f73662d6e65696768626f7572686f6f642d757064617465732f6e65775f636f6e7469672e706e67" data-canonical-src="https://mapzen-assets.s3.amazonaws.com/images/sf-neighbourhood-updates/new_contig.png" style="max-width:100%;"></a></p> <p><em>Image: San Francisco neighbourhood records from Who's On First projected in QGIS.</em></p> <p>In some cities, we have detailed polygon shapes for most, but not all neighbourhoods. Occassionally, we only know the name and the approximate point representing the label centroid. We need to establish a concordance between all WOF records, points and polygons. We'll need to add a polygon shape to replace these points; this is covered below in step four.</p> <h2 id="2-research-other-neighbourhood-sources">2: Research other neighbourhood sources</h2> <p>In this section, you will:</p> <ul> <li><strong>Find</strong> new data to import</li> <li><strong>Verify</strong> open license</li> </ul> <p>Because Who’s On First is liberally licensed open data, we must be selective about adding new data. We either need to find a new source that is open data with a CC-BY or CC-0 license that allows commercial and derivative works or create new shapes based on local knowledge and by cross-referencing multiple sources. Ideally, this new source should be an improvement over what Who’s On First already knows about the place.</p> <p>In our example, the City and County of San Francisco hosts various <a href="https://data.sfgov.org/browse?q=neighborhoods">neighbourhood-related shapefiles</a> through it's OpenData portal, so we had a few options to choose from.</p> <p>Just because your locality hosts a neighbourhood dataset, does not mean the neighbourhood geometries are useable. For example, city planning departments often group neighbourhoods together for planning purposes; you can start with these geometries, but they should be double-checked before import. For instance, if a shape is named <em>Name 1</em> - <em>Name 2</em> - <em>Name 3</em> (e.g. Mission-Potrero-SoMa), it should <em>probably</em> be split into three polygons before import, one for each neighbourhood.</p> <p>Don't blindly trust an authoritative set of neighbourhood shapes. Review a few other neighbourhood sources to compare names, attributes, shape detail, and coverage. Ensuring that you have an accurate set of neighbourhood shapes and adequate attributes will save time when reconciling the data with existing Who's On First records.</p> <p>In San Francisco, we did not choose the planning department shapes, as those were too coarse and used more for statistical groupings (there weren’t as many neighbourhoods as we had already, and their shapes were way too big, more like macrohoods). After research, it was found that the Mayor's Office created a set of geometries that were built to match local expectations and there was a similar number of places to what was in Who’s On First. Their colloquial shapes matched up with what we thought they should like as San Francisco locals.</p> <p>Once we verified the data was provided through an <a href="https://data.sfgov.org/terms-of-use">open license</a>, we created a <a href="https://github.com/whosonfirst/whosonfirst-sources/blob/master/sources/sfgov.json">new source</a>, <code>sfgov</code>, in our <a href="https://github.com/whosonfirst/whosonfirst-sources/tree/master/sources">sources repository</a> to give credit to the original author. This dataset was then downloaded to our desktop and added to a new QGIS document to compare with the existing shapes in WOF. Lucky for us, the SF OpenData is already in the WGS84 projection and does not need to be reprojected.</p> <p>Lastly, we need to add any properties that are retained from the source data file to our <a href="https://github.com/whosonfirst/whosonfirst-properties/blob/master/aliases/property_aliases.json">properties_alias.json file</a>. In San Francisco, for example, we have a <code>sfgov:name</code> field. In order to bring this property in, we will need to add it to the property_alias.json file (see file for formatting examples).</p> <h2 id="3-download-authoritative-neighbourhood-geometries">3: Download authoritative neighbourhood geometries</h2> <p>In this section, you will:</p> <ul> <li><strong>Download</strong> data</li> <li><strong>Open</strong> your data</li> <li><strong>Begin comparison</strong> with existing Who's On First records</li> </ul> <p><a href="https://camo.githubusercontent.com/6162a43208bc84d9a8a8df079030559b1fc0b2bb/68747470733a2f2f6d61707a656e2d6173736574732e73332e616d617a6f6e6177732e636f6d2f696d616765732f73662d6e65696768626f7572686f6f642d757064617465732f73665f6f70656e646174612e706e67" target="_blank"><img width="600" alt="SF OpenData neighbourhood data projected in QGIS" src="https://camo.githubusercontent.com/6162a43208bc84d9a8a8df079030559b1fc0b2bb/68747470733a2f2f6d61707a656e2d6173736574732e73332e616d617a6f6e6177732e636f6d2f696d616765732f73662d6e65696768626f7572686f6f642d757064617465732f73665f6f70656e646174612e706e67" data-canonical-src="https://mapzen-assets.s3.amazonaws.com/images/sf-neighbourhood-updates/sf_opendata.png" style="max-width:100%;"></a></p> <p><em>Image: SF OpenData neighbourhood data projected in QGIS.</em></p> <p>Once the data source was added to our source repository, the data was downloaded and placed into a new QGIS document (above) to compare to the geometries of WOF records. You can see the clean, non-overlapping geometries in the SF OpenData, unlike our existing WOF geometries (below).</p> <p><a href="https://camo.githubusercontent.com/5ea8c0b725090235b700fe26a0d98a01ba54e78c/68747470733a2f2f6d61707a656e2d6173736574732e73332e616d617a6f6e6177732e636f6d2f696d616765732f73662d6e65696768626f7572686f6f642d757064617465732f322e676966" target="_blank"><img width="600" alt="SF OpenData neighbourhood data projected in QGIS" src="https://camo.githubusercontent.com/5ea8c0b725090235b700fe26a0d98a01ba54e78c/68747470733a2f2f6d61707a656e2d6173736574732e73332e616d617a6f6e6177732e636f6d2f696d616765732f73662d6e65696768626f7572686f6f642d757064617465732f322e676966" data-canonical-src="https://mapzen-assets.s3.amazonaws.com/images/sf-neighbourhood-updates/2.gif" style="max-width:100%;"></a></p> <p><em>Image: WOF records projected in QGIS.</em></p> <p>Now that we have WOF records and data provided by the City of San Francisco, we can begin reconciling the two datasets. We will join the two datasets based on a common attribute; in this case the <code>wof:name</code> field from the WOF data was joined to the SF OpenData's <code>name</code> field. The join tool in QGIS can be found by navigating to the properties of the WOF .geojson layer and clicking the "Join" option (below).</p> <p><a href="https://camo.githubusercontent.com/c7552a1fbede388b8544957180aa576f82b793b8/68747470733a2f2f6d61707a656e2d6173736574732e73332e616d617a6f6e6177732e636f6d2f696d616765732f73662d6e65696768626f7572686f6f642d757064617465732f352e706e67" target="_blank"><img width="600" alt="Join Properties tab in QGIS" src="https://camo.githubusercontent.com/c7552a1fbede388b8544957180aa576f82b793b8/68747470733a2f2f6d61707a656e2d6173736574732e73332e616d617a6f6e6177732e636f6d2f696d616765732f73662d6e65696768626f7572686f6f642d757064617465732f352e706e67" data-canonical-src="https://mapzen-assets.s3.amazonaws.com/images/sf-neighbourhood-updates/5.png" style="max-width:100%;"></a></p> <p><em>Image: Join Properties tool in QGIS.</em></p> <p>In an ideal world, all WOF records would join cleanly to SF OpenData records, but that is typically not the case. This join method worked for the most part, but because the spellings are not identical between each of the attribute tables, this join needs to be verified and improved by hand. For example, QGIS's join tool did not join a value of <code>Haight Ashbury</code> to a value of <code>Haight-Ashbury</code> or a value of <code>Mission District</code> to a value of <code>Mission</code>. As described below, it's not a matter of which name field is "more correct", but a matter of importing additional names from your authoritative source while preserving the existing <code>wof:name</code> in a <code>eng_x_variant</code> name field.</p> <p>Alternately, we could perform this join based on location, instead of an attribute field. QGIS has functionality to perform a spatial join (<a href="http://www.qgistutorials.com/en/docs/performing_spatial_joins.html">some documentation here</a>), which would be helpful if our WOF geometries were geographically similar to our administrative data. However, because our geometries in San Francisco overlap substantially with the SF OpenData geometries, an attribute join is more likely to give us matching records between the two datasets (generally, neighbourhood names are unique in city). If you are unsure of which join is best for your locality, give them both a try and compare the results.</p> <p>Occasionally, Who's On First has duplicate records. Duplicate records <em>should</em> be noted in the <code>mz:note</code> property (with a "duplicate", "dupe" or "dup" value) or with a <code>1</code> value in the <code>mz:is_funky</code> or <code>mz:is_current</code> property. If you come across duplicate features when comparing and joining records, prefer the current record over the record with a <code>mz:note</code> of "duplicate", "dupe" or "dup" or a <code>1</code> value in the <code>mz:is_funky</code> or <code>mz:is_current</code> property.</p> <table> <thead> <tr> <th>Who's On First</th> <th>SF OpenData</th> <th>Note</th> </tr> </thead> <tbody> <tr> <td>Alamo Square</td> <td>Alamo Square</td> <td><em>in both, great! Let's import the new geometry!</em></td> </tr> <tr> <td>Anza Vista</td> <td>Anza Vista</td> <td><em>in both, great! Let's import the new geometry!</em></td> </tr> <tr> <td>Baja Noe</td> <td></td> <td><em>no match, no alternate name spelling, WOF only</em></td> </tr> <tr> <td>Bret Harte</td> <td><em>no WOF record, let's research.</em></td> <td></td> </tr> <tr> <td>Haight Ashbury</td> <td></td> <td><em>no name match, but does have alternate name: <code>Haight-Ashbury</code></em></td> </tr> <tr> <td>Cathedral Hill</td> <td>Cathedral Hill</td> <td><em>in both, great!</em></td> </tr></tbody></table> <p><em>Image: Comparison of WOF and SF OpenData name attributes.</em></p> <p>This method assigned <code>wof:id</code> values to each SF OpenData record that joined to a WOF record. After comparing, <strong>96</strong> of <strong>117</strong> SF OpenData records were assigned a <code>wof:id</code>. With the records that did not join based on the <code>name</code> field join, we will have to reconcile, adding the <code>wof:id</code> manually whenever possible. This is done easiest by reviewing each name in your WOF attributes table with  each name of your source data.</p> <p><a href="https://camo.githubusercontent.com/cf947b912a8adc9619141179960ad39ecd6a89be/68747470733a2f2f6d61707a656e2d6173736574732e73332e616d617a6f6e6177732e636f6d2f696d616765732f73662d6e65696768626f7572686f6f642d757064617465732f6a6f696e65645f617474726962757465732e706e67" target="_blank"><img width="300" alt="Attributes table after joining datasets" src="https://camo.githubusercontent.com/cf947b912a8adc9619141179960ad39ecd6a89be/68747470733a2f2f6d61707a656e2d6173736574732e73332e616d617a6f6e6177732e636f6d2f696d616765732f73662d6e65696768626f7572686f6f642d757064617465732f6a6f696e65645f617474726962757465732e706e67" data-canonical-src="https://mapzen-assets.s3.amazonaws.com/images/sf-neighbourhood-updates/joined_attributes.png" style="max-width:100%;"></a></p> <p><em>Image: SF OpenData attribute table after joining datasets. Records with NULL values need to be imported by hand.</em></p> <p>Examples of neighbourhoods that WOF did not have at the time of import are <code>Appearel City</code> and <code>Buena Vista</code> (meaning these records will need a new WOF ID). Since these neighbourhoods were not in the WOF database, we should consider importing them as new neighbourhood records.</p> <h2 id="4-reconciling-our-data-sources">4: Reconciling our data sources</h2> <p>In this section, you will:</p> <ul> <li><strong>Develop</strong> an action plan to modify data</li> <li>Note possible <strong>data modifications</strong> needed in our datasets</li> </ul> <p><strong>Remember</strong> - not all of the existing neighbourhood records matched to an SF OpenData geometry (96 new records were given existing IDs, but there were 165 existing neighbourhood records). This begs the question: <em>What should happen to the 69 leftover neighbourhood records?</em></p> <p>There are three options for the 69 leftover records:</p> <ul> <li><strong>Deprecate</strong> the record, as it was never a valid neighbourhood to begin with. Research can't verify this name or shape. Sometimes a neighbourhood falls out of common usage, or the error was an error.</li> <li><strong>Downgrade</strong> the record as a microhood and give it a <code>parented_by</code> value for the neighbourhood it falls within. People still use this name, but only the residents of those few city blocks.</li> <li><strong>Upgrade</strong> the neighbourhood records to a macrohood (see: <em>Sunset, Richmond, Downtown</em>).</li> </ul> <h3 id="modifying-sf-opendata">Modifying SF OpenData</h3> <p>Before importing the city-provided geometries, it is important to ensure the new neighbourhood boundaries will work in Who’s On First. While we can easily import the new neighbourhood geometries raw from our source (SF OpenData), we should "trust but verify" our data before the  import.</p> <p>The majority of geometries in the SF OpenData source were imported as-is, though four neighbourhood records in our San Francisco example were edited prior to import. Using our local knowledge and opinions, we adjusted these neighbourhood boundaries slightly.</p> <h3 id="modifying-wof-data">Modifying WOF Data</h3> <p>After our WOF shapes were added to a QGIS document (below), they were given a new integer attribute field titled "status" based on concordance with our administrative source data. The status values were color-coded to display the following options for each of WOF neighbourhood records:</p> <ul> <li><strong>1 - Neighbourhood.</strong> <em>Valid neighbourhood record. Both datasets agree this is a neighbourhood, probably needs a new shape and name.</em></li> <li><strong>2 - Reclassify up to macrohood.</strong> <em>Neighbourhood records that will become macrohood records.</em></li> <li><strong>3 - Reclassify down to microhoods.</strong> <em>Neighbourhood records that will be reclassified as microhood records. WOF records not in SF OpenData that are smaller than the surrounding neighbourhood should change placetypes to microhood.</em></li> <li><strong>4 - Reclassify down to microhoods... maybe.</strong> <em>Needs more investigation. Probably change placetype to a microhood.</em></li> <li><strong>5 - Deprecate neighbourhood.</strong> <em>Invalid record, should be "deprecated" and "superseded" in WOF. Everyone agrees this neighbourhood is an error.</em></li> </ul> <p><a href="https://camo.githubusercontent.com/52c02a452678e439dc309363c92f728e0941ddc2/68747470733a2f2f6d61707a656e2d6173736574732e73332e616d617a6f6e6177732e636f6d2f696d616765732f73662d6e65696768626f7572686f6f642d757064617465732f7265636f72645f7374617475732e706e67" target="_blank"><img width="600" alt="Assigning records' status in QGIS" src="https://camo.githubusercontent.com/52c02a452678e439dc309363c92f728e0941ddc2/68747470733a2f2f6d61707a656e2d6173736574732e73332e616d617a6f6e6177732e636f6d2f696d616765732f73662d6e65696768626f7572686f6f642d757064617465732f7265636f72645f7374617475732e706e67" data-canonical-src="https://mapzen-assets.s3.amazonaws.com/images/sf-neighbourhood-updates/record_status.png" style="max-width:100%;"></a></p> <p><em>Image: Developing an action plan in QGIS by assigning records' status in QGIS, reviewing WOF record matches with new SF OpenData source. Colors represent status value.</em></p> <p><strong>Congratulations!</strong> You have finished collecting and evaluating new neighbourhood shapes for WOF! In the next part of this tutorial, we'll prepare the data for import. But first, a well-deserved break.</p> <p>To finalize your work and prepare data for import, check out <a href="https://github.com/whosonfirst/whosonfirst-cookbook/blob/master/issue_workflows/sf_neighbourhood_updates_pt_2.md">part two</a>!</p> 
<!-- https://github.com/whosonfirst/whosonfirst-cookbook/blob/master/issue_workflows/sf_neighbourhood_updates_pt_1.md -->
 <p>The <a href="https://whosonfirst.mapzen.com/">Who's On First</a> (WOF) project is not pretending to be the authority of truth, but rather a home for data from various sources and a project that we hope generates discussion. The WOF gazetteer houses data for many geographies, including counties (which parent cities) and cities (which parent microhoods, neighbourhoods, and macrohoods). Neighbourhoods are the places where we live and work in cities; <em>the more neighbourhood data, the better.</em></p> <p><a href="https://camo.githubusercontent.com/a64c3504cd94e619873f2c487faf57c9446f4ec4/68747470733a2f2f6d61707a656e2d6173736574732e73332e616d617a6f6e6177732e636f6d2f696d616765732f73662d6e65696768626f7572686f6f642d757064617465732f312e6a7067" target="_blank"><img src="https://camo.githubusercontent.com/a64c3504cd94e619873f2c487faf57c9446f4ec4/68747470733a2f2f6d61707a656e2d6173736574732e73332e616d617a6f6e6177732e636f6d2f696d616765732f73662d6e65696768626f7572686f6f642d757064617465732f312e6a7067" alt="San Francisco, CA" data-canonical-src="https://mapzen-assets.s3.amazonaws.com/images/sf-neighbourhood-updates/1.jpg" style="max-width:100%;"></a> <em>Photo Credit: <a href="https://www.flickr.com/photos/photographingtravis/15876578760/in/photolist-qbXBJy-wS7pFF-2XzRnL-HbtCbX-rbmAJj-7dPz43-9Py6me-hEkAuS-8gihrC-8BCzsr-uVZPsT-92LBPi-Ecaiho-HDBW9C-7dPw9s-exakrT-dNzgiu-aJaiTz-nK4F3y-FtbMW-bywi7N-hzeCpW-8HXuPC-jeVkWQ-uiA2S7-pzMxbL-bjH5AC-bsyv8U-keLDPc-gWDhS-xadSek-nQz7At-brj2fe-wuPTK4-4856y6-pdYCPT-wSCsAz-FtesM-7j84Hs-dqBe97-5RT97n-fzhNSx-4heGvv-fKii4T-nqgSDG-xpnL1d-dHcAn7-pQYC72-9wduZD-wuF3bm_">Travis Wise, Flickr</a></em></p> <p><strong>Our Audience:</strong> Those who care about neighbourhoods and have a few hours to a few days to spend diving into QGIS.</p> <p><strong>Your Skills/Experience:</strong> This tutorial was written with the intermediate to advanced GIS user. While this tutorial tries to explain the editing process in detail, some information may not be immediately clear to a beginning user.</p> <p><strong>Why are neighbourhoods important to mapping?</strong></p> <ul> <li><strong>Labelling.</strong> When we use a mapping application, we want neighbourhoods to be labeled on the map (in the right place and at the right zoom).</li> <li><strong>Ability to search.</strong> Neighbourhoods should be searchable (with the ability to know how large the feature is and fit it into view).</li> <li><strong>Browsing venues.</strong> We should be able to browse venues by neighbourhood.</li> </ul> <p>It is important to understand where <a href="https://github.com/whosonfirst/whosonfirst-placetypes">placetypes</a> fall within the WOF hierarchy. Neighbourhoods, macrohoods, and microhoods are described below:</p> <ul> <li><strong>Neighbourhoods:</strong> A centralized community within a larger city, town, or borough.</li> <li><strong>Macrohoods:</strong> A grouping of neighbourhoods within a larger city, town, or borough.</li> <li><strong>Microhoods:</strong> A geographically localized sub-section of a neighbourhood.</li> </ul> <p>This tutorial addresses the issues we found with San Francisco's neighbourhoods and describes the workflow we took in fixing them. In the end, we hope you can follow along and edit neighbourhoods for your own city!</p> <p><strong>What are your options when updating neighbourhoods?</strong></p> <ul> <li>Notice just one neighbourhood that needs cleaning up? File a <a href="https://github.com/whosonfirst/whosonfirst-data/issues/new">Github issue</a>, or <a href="mailto:stephen.epps@mapzen.com">email us</a>. <em>[See something, say something.]</em></li> <li>Notice an open dataset of administrative data? Open an <a href="https://github.com/whosonfirst/whosonfirst-data/issues/new">issue</a> in our WOF repository.</li> <li>Still interested but confused about all this Github and WOF-isms? We can send you a "starter kit" that includes your requested neighbourhoods. <a href="mailto:stephen.epps@mapzen.com">Email us</a>.</li> <li>Follow the instructions below and send us a <a href="https://github.com/whosonfirst/whosonfirst-data/pulls">pull request</a>.</li> </ul> <p><strong>Key terms:</strong></p> <p>Check out <a href="https://github.com/whosonfirst/whosonfirst-cookbook/blob/master/definition/key_terms.md">these key terms</a> if you have any questions about the vocabulary used in this guide.</p> <h2 id="the-issue">The Issue</h2> <p>We received a <a href="https://github.com/whosonfirst/whosonfirst-data/issues/125">report</a> in the <a href="https://github.com/whosonfirst/whosonfirst-data">whosonfirst-data repository</a> that the shape of San Francisco’s Golden Gate Park neighbourhood was both too small and extended into adjacent neighbourhoods. While researching online sources for a better shape, we noticed that most adjacent neighbourhood shapes in WOF could also be improved to align better with the road network and local expectations. After researching neighbourhood shapes online, we downloaded neighbourhood shapes for San Francisco from <a href="https://data.sfgov.org/">SF OpenData</a>, a city data website, to compare with the neighbourhood records in our WOF repository. We then filed a <a href="https://github.com/whosonfirst/whosonfirst-data/issues/316">new issue</a> to handle all neighbourhood updates for San Francisco.</p> <p>Typically, Who’s On First sources <a href="http://www.quattroshapes.com">Quattroshapes</a> geometries for most neighbourhoods around the globe. However, many neighbourhoods in the United States, including San Francisco, source their default geometry from <a href="http://www.zetashapes.com">Zetashapes</a>. The Zetashapes project follows the same basic principles as Quattroshapes, but builds shapes up from Census 2010 features and can draw shapes that are too big, small, or <em>just plain weird</em>. We’ve seen problems with shapes extending in the water and far out into neighboring rural areas. This technique is responsible for the issues that we are correcting in San Francisco.</p> <p>Drawing neighbourhood shapes is a tricky business. Strangers generally agree on what a neighbourhood is named and its rough shape, but even good friends can argue vehemently about where one neighbourhood ends and another begins - even if there are hard edges between neighbourhoods or they should overlap. Recognizing this, Who’s On First allows multiple alternate geometries for a place, but for practical reasons we need to set just one shape as the default geometry.</p> <p><strong>To clean up our neighbourhood geometries, we needed to take five steps:</strong></p> <ul> <li><strong>#1</strong> <em>Review WOF records for your locality. Get a sense of where they could be improved and where they are acceptable, focusing on names and shapes.</em></li> <li><strong>#2</strong> <em>Research other neighbourhood sources on the internet.</em></li> <li><strong>#3</strong> <em>Download authoritative neighbourhood geometries from a reliable, open license data source for your locality.</em></li> <li><strong>#4</strong> <em>Reconciling our data sources. Things to think about: Is the number of neighbourhood records similar? Are the shapes similar or better? Could you draw your own shapes?</em></li> <li><strong>#5</strong> <em>Update records, either though a clean import or creating a new hybrid using the best of both (and your local knowledge).</em></li> </ul> <p>While specifics listed in this tutorial may reference San Francisco, our hope is that you will be able to follow along with these steps to update the neighbourhood records in your locality.</p> <h2 id="1-review-whos-on-first-records-for-your-locality">1: Review Who's On First records for your locality</h2> <p>In this section, you will either:</p> <ul> <li>Use the handy <a href="https://whosonfirst.mapzen.com/spelunker/download/85688637/?exclude=nullisland#5/37.419/-119.307">Bundler Tool</a> (this example link points to descendants of California) to gather a collection of neighbourhood features in your given locality</li> </ul> <p><strong>OR</strong></p> <ul> <li>Use the <code>git checkout</code> command in your terminal to <strong>clone necessary repositories</strong></li> <li><strong>Collect</strong> a .geojson file for all neighbourhoods in your locality (city)</li> <li>Add your .geojson file to a QGIS document for <strong>review</strong></li> </ul> <p>The Bundler Tool quickly gathers a collection of descendant records in GeoJSON format given your the parent record's ID. Simply click the "Download Descendants" link on any record's page in the Spelunker.</p> <p>This is the "quick and easy" method to gathering neighbourhood records, however, this tool only gathers up to 500 WOF records. For larger queries or markets, you will need to clone necessary repositories and collect a .geojson file. Instructions below:</p> <ul> <li>Ensure that you have the most recent software packages. Windows users should have Powershell 3.0 before beginning any GitHub work from the terminal. A Powershell 3.0 download can be found <a href="https://www.microsoft.com/en-us/download/details.aspx?id=34595">here</a>. Additionally, all users should ensure they have <code>setuptools</code> for Python by <a href="https://pypi.python.org/pypi/setuptools">downloading</a> Python 2.7 (or a more current version) and <code>GDAL 2.1</code> by <a href="http://www.qgis.org/en/site/">downloading</a> QGIS 2.14 (or a more current version).</li> <li>Run <code>git checkout</code> on the <a href="https://github.com/whosonfirst/whosonfirst-data">WOF Data repository</a>, <a href="https://github.com/whosonfirst/whosonfirst-properties">WOF Properties repository</a>, and <a href="https://github.com/whosonfirst/py-mapzen-whosonfirst-utils">WOF Utils repository</a>.</li> <li>Run the <code>install</code> script in whosonfirst-utils repository.</li> <li>Open the <code>WOF-csv-to-feature-collection.py</code> script in your <code>Utils</code> repo. Update line 63 with your local filepath.</li> </ul> <p>Once complete, entering the following string in the terminal from the whosonfirst-utils repository's <code>scripts</code> folder allows us to collect San Francisco's neighbourhoods as a single .geojson file (updating filepaths of your local machine accordingly):</p> <blockquote> <p><em>python WOF-csv-to-feature-collection -p /usr/local/mapzen/whosonfirst-data/data -c /usr/local/mapzen/whosonfirst-data/meta/WOF-neighbourhood-latest.csv --aliases /usr/local/mapzen/whosonfirst-properties/aliases/property_aliases.json -o ~/Desktop/SF_Neighbourhoods.geojson --slim --slim-template external_editor -f 85922583</em></p> </blockquote> <p><a href="https://camo.githubusercontent.com/7ab32c9ad12b117b82ca4139be9ea4802c8034e5/68747470733a2f2f6d61707a656e2d6173736574732e73332e616d617a6f6e6177732e636f6d2f696d616765732f73662d6e65696768626f7572686f6f642d757064617465732f7465726d696e616c5f636f6d6d616e642e706e67" target="_blank"><img width="600" alt="San Francisco neighbourhood records in WOF" src="https://camo.githubusercontent.com/7ab32c9ad12b117b82ca4139be9ea4802c8034e5/68747470733a2f2f6d61707a656e2d6173736574732e73332e616d617a6f6e6177732e636f6d2f696d616765732f73662d6e65696768626f7572686f6f642d757064617465732f7465726d696e616c5f636f6d6d616e642e706e67" data-canonical-src="https://mapzen-assets.s3.amazonaws.com/images/sf-neighbourhood-updates/terminal_command.png" style="max-width:100%;"></a></p> <p><em>Image: Data collection script in the terminal.</em></p> <p><em>Note: The trailing number <code>85922583</code> at the end of this script is the WOF ID for <a href="https://whosonfirst.mapzen.com/spelunker/id/85922583/#10/37.7850/-122.7278">San Francisco</a>. When running this script, make sure to update that ID with whatever record you need neighbourhood geometries for. An ID is a unique identifier for records in WOF. Each record in WOF has an ID. To find the ID for your city, search the <a href="https://whosonfirst.mapzen.com/spelunker">Spelunker</a> and copy the ID.</em></p> <p><strong>Voilà!</strong> We have a .geojson of WOF neighbourhood records in San Francisco! By changing the trailing ID (explained below), you can collect neighbourhood records for your own locality (city).</p> <p>To better understand what we're requesting of our command, here is a breakdown of exactly what is included:</p> <ul> <li><strong><code>python</code></strong>  Used to invoke python</li> <li><strong><code>WOF-csv-to-feature-collection</code></strong>  The python script that collects WOF records.</li> <li><strong><code>-p /PATH/whosonfirst-data/data</code></strong> sets the path to the local copy of all the WOF data. You will need to update this PATH depending on where you checked the file out.</li> <li><strong><code>-c /PATH/whosonfirst-data/meta/WOF-neighbourhood-latest.csv</code></strong> The metafile for the placetype you are interested in - neighbourhood. You will need to update this PATH depending on where you checked the file out.</li> <li><strong><code>--aliases /usr/local/mapzen/whosonfirst-properties/aliases/property_aliases.json</code></strong> Pulling in various aliases for attribute fields for your output file.</li> <li><strong><code>-o ~/Desktop/SFNeighbourhoods.geojson</code></strong> Your output file.</li> <li><strong><code>--slim</code></strong> Option parser to limit property export to subset (roughly those in the CSV file) and reduce file size.</li> <li><strong><code>--slim-template</code></strong> Option parser to trim key names to fit Esri Shapefile format (10 charachter length limit).</li> <li><strong><code>external_editor</code></strong> Return only necessary attribute fields for neighbourhood edits.</li> <li><strong><code>-f 85922583</code></strong> ID of the locality you need neighbourhood records for, found by searching our <a href="https://whosonfirst.mapzen.com/spelunker">Spelunker</a>.</li> </ul> <p><strong>About the <code>external_editor</code> option:</strong></p> <ul> <li> <p>This option was created for our neighbourhood editors and exports only relevant and required record attributes for WOF neighbourhood records. All required attributes (and applicable optional attributes) should be included when filing your PR of updated neighbourhood records. The <code>external_editor</code> attribute fields include:</p> </li> <li> <p><strong>'name'</strong> The attribute that will be used for the <code>wof:name</code> field. Required for all files.</p> </li> <li> <p><strong>'id'</strong> The attribute that will be used for the <code>wof:id</code> field. Required for all files.</p> </li> <li> <p><strong>'placetype'</strong> The attribute that will be used for the <code>wof:placetype</code> field. Required for all files.</p> </li> <li> <p><strong>'parent_id'</strong> The attribute that will be used for the <code>wof:parent_id</code> field. Should equal the <code>wof:id</code> of the next placetype up in the feature's hierarchy. Required for all files.</p> </li> <li> <p><strong>'is_landuse_aoi'</strong> Used to signify an "area of interest" land use, different than the <code>wof:placetype</code> would suggest.</p> </li> <li> <p><strong>'supersedes'</strong> The attribute that will be used for the <code>wof:supersedes</code> field. Required for all files that supersede another WOF record.</p> </li> <li> <p><strong>'superseded_by'</strong> The attribute that will be used for the <code>wof:superseded_by</code> field. Required for all files that are superseded by another WOF record.</p> </li> <li> <p><strong>'deprecated'</strong> The attribute that will be used for the <code>edtf:deprecated</code> field. A date field <em>(YYYY-MM-DD)</em> used to signify when we determined this record was "junk" and incorrect since inclusion in Who's On First. Required for all files that are deprecated. (see: <a href="https://github.com/whosonfirst/whosonfirst-cookbook/blob/master/definition/deprecated_vs_cessation.md">cessation vs. deprecated documentation</a>)</p> </li> <li> <p><strong>'cessation'</strong> The attribute that will be used for the <code>edtf:cessation</code> field. A date field <em>(YYYY-MM-DD)</em> used to signify when we determined this record was no longer valid in Who's On First (usually when it has been replaced by another record). Also requires a new field called <code>mz:is_current</code> to be created. The <code>mz:is_current</code> field value is '0' if the record has a <code>edtf:cessation</code> date. (see: <a href="https://github.com/whosonfirst/whosonfirst-cookbook/blob/master/definition/deprecated_vs_cessation.md">cessation vs. deprecated documentation</a>)</p> </li> <li> <p><strong>'eng_preferred_name'</strong> Preferred alternative names for a feature.</p> </li> <li> <p><strong>'eng_variant_name'</strong> Variant alternative names for a feature.</p> </li> <li> <p><strong>'max_zoom'</strong> Maximum zoom level at which feature labels appear on a map. Required for all new features to Who's On First.</p> </li> <li> <p><strong>'min_zoom'</strong> Minimum zoom level at which feature labels appear on a map. Required for all new features to Who's On First.</p> </li> <li> <p><strong>'lbl_latitude'</strong> A decimal value of a feature's Y coordinate. Value should be derived from <a href="https://github.com/mbloch/mapshaper">MapShaper</a> and included on any new shape imported to Who's On First. New X/Y coordinates attributes will be created when running a geojson or shapefile through the MapShaper tool. These new fields will be used for <code>lbl:latitude</code> and <code>lbl:longitude</code>. The MapShaper tool is also available via <a href="http://mapshaper.org/">http://mapshaper.org/</a>.</p> </li> <li> <p><strong>'lbl_longitude'</strong> A decimal value of a feature's X coordinate. Value should be derived from <a href="https://github.com/mbloch/mapshaper">MapShaper</a> and included on any new shape imported to Who's On First. New X/Y coordinates attributes will be created when running a geojson or shapefile through the MapShaper tool. These new fields will be used for <code>lbl:latitude</code> and <code>lbl:longitude</code>. The MapShaper tool is also available via <a href="http://mapshaper.org/">http://mapshaper.org/</a>.</p> </li> <li> <p><strong>'rev_lat'</strong> Equal to the <code>lbl_latitude</code> value. This field will be used to rebuild the feature's hierarchy.</p> </li> <li> <p><strong>'rev_long'</strong> Equal to the <code>lbl_longitude</code> value. This field will be used to rebuild the feature's hierarchy.</p> </li> <li> <p><strong>'is_funky'</strong> Optional.</p> </li> <li> <p><strong>'is_hard_boundary'</strong> Optional.</p> </li> <li> <p><strong>'is_official'</strong> Optional.</p> </li> <li> <p><strong>'tier_locality'</strong> Optional.</p> </li> <li> <p><strong>'country_id'</strong> The <code>wof:id</code> of the feature's parent country.</p> </li> <li> <p><strong>'region_id'</strong> The <code>wof:id</code> of the feature's parent region.</p> </li> <li> <p><strong>'locality_id'</strong> The <code>wof:id</code> of the feature's parent locality.</p> </li> <li> <p><strong>'WOF_country'</strong> Usually equal to the ISO code, this is a two-digit key representing the country your features are in. Required for all features.</p> </li> <li> <p><strong>'iso_country'</strong> Set by the <a href="http://www.iso.org/iso/home.html">Internation Organization for Standardization</a>, This is a two-digit key (listed <a href="https://en.wikipedia.org/wiki/ISO_3166-1">here</a>) representing the country your features are in. Required for all features.</p> </li> <li> <p><strong>'src_geom'</strong> Optional. Contains the source name of the feature's geometry. Given for research purposes.</p> </li> <li> <p><strong>'mz_note'</strong> Optional. Contains information about that given feature, if available.</p> </li> </ul> <p>From the WOF repository for San Francisco, a total of <strong>165</strong> (157 polygon geometries, 8 point geometries) records for neighbourhoods were collected using our <code>external_editor</code> option. QGIS was used to preview Who’s On First neighbourhood shapes (below).</p> <p><a href="https://camo.githubusercontent.com/49d5dd4e6e75c5f4bea63c1a897f811d352008a1/68747470733a2f2f6d61707a656e2d6173736574732e73332e616d617a6f6e6177732e636f6d2f696d616765732f73662d6e65696768626f7572686f6f642d757064617465732f6261795f6f76657276696577312e706e67" target="_blank"><img width="600" alt="San Francisco neighbourhood records in WOF" src="https://camo.githubusercontent.com/49d5dd4e6e75c5f4bea63c1a897f811d352008a1/68747470733a2f2f6d61707a656e2d6173736574732e73332e616d617a6f6e6177732e636f6d2f696d616765732f73662d6e65696768626f7572686f6f642d757064617465732f6261795f6f76657276696577312e706e67" data-canonical-src="https://mapzen-assets.s3.amazonaws.com/images/sf-neighbourhood-updates/bay_overview1.png" style="max-width:100%;"></a></p> <p><em>Image: San Francisco neighbourhood records (light purple) in comparison to the San Francisco Bay Area and the WOF shapes of San Francisco (blue).</em></p> <p>You might notice the general shape of San Francisco present in the photo below, but it's tough to make out. Many of these WOF neighbourhood shapes cross into what most people would consider a different neighbourhood, and, in two cases, include areas in different counties. The good news? The majority of these neighbourhood records contain usable information in their WOF attribute fields. Also, be mindful of the differences between single-part and multi-part polygon edits in QGIS. If your neighbourhood shapes are single-part polygons to begin with, you are unable to add a multi-part polygon into your feature collection.</p> <p><a href="https://camo.githubusercontent.com/fabff0217b29c685a58add090fe182e51bffa5f8/68747470733a2f2f6d61707a656e2d6173736574732e73332e616d617a6f6e6177732e636f6d2f696d616765732f73662d6e65696768626f7572686f6f642d757064617465732f6e65775f636f6e7469672e706e67" target="_blank"><img width="600" alt="San Francisco neighbourhood records in WOF" src="https://camo.githubusercontent.com/fabff0217b29c685a58add090fe182e51bffa5f8/68747470733a2f2f6d61707a656e2d6173736574732e73332e616d617a6f6e6177732e636f6d2f696d616765732f73662d6e65696768626f7572686f6f642d757064617465732f6e65775f636f6e7469672e706e67" data-canonical-src="https://mapzen-assets.s3.amazonaws.com/images/sf-neighbourhood-updates/new_contig.png" style="max-width:100%;"></a></p> <p><em>Image: San Francisco neighbourhood records from Who's On First projected in QGIS.</em></p> <p>In some cities, we have detailed polygon shapes for most, but not all neighbourhoods. Occassionally, we only know the name and the approximate point representing the label centroid. We need to establish a concordance between all WOF records, points and polygons. We'll need to add a polygon shape to replace these points; this is covered below in step four.</p> <h2 id="2-research-other-neighbourhood-sources">2: Research other neighbourhood sources</h2> <p>In this section, you will:</p> <ul> <li><strong>Find</strong> new data to import</li> <li><strong>Verify</strong> open license</li> </ul> <p>Because Who’s On First is liberally licensed open data, we must be selective about adding new data. We either need to find a new source that is open data with a CC-BY or CC-0 license that allows commercial and derivative works or create new shapes based on local knowledge and by cross-referencing multiple sources. Ideally, this new source should be an improvement over what Who’s On First already knows about the place.</p> <p>In our example, the City and County of San Francisco hosts various <a href="https://data.sfgov.org/browse?q=neighborhoods">neighbourhood-related shapefiles</a> through it's OpenData portal, so we had a few options to choose from.</p> <p>Just because your locality hosts a neighbourhood dataset, does not mean the neighbourhood geometries are useable. For example, city planning departments often group neighbourhoods together for planning purposes; you can start with these geometries, but they should be double-checked before import. For instance, if a shape is named <em>Name 1</em> - <em>Name 2</em> - <em>Name 3</em> (e.g. Mission-Potrero-SoMa), it should <em>probably</em> be split into three polygons before import, one for each neighbourhood.</p> <p>Don't blindly trust an authoritative set of neighbourhood shapes. Review a few other neighbourhood sources to compare names, attributes, shape detail, and coverage. Ensuring that you have an accurate set of neighbourhood shapes and adequate attributes will save time when reconciling the data with existing Who's On First records.</p> <p>In San Francisco, we did not choose the planning department shapes, as those were too coarse and used more for statistical groupings (there weren’t as many neighbourhoods as we had already, and their shapes were way too big, more like macrohoods). After research, it was found that the Mayor's Office created a set of geometries that were built to match local expectations and there was a similar number of places to what was in Who’s On First. Their colloquial shapes matched up with what we thought they should like as San Francisco locals.</p> <p>Once we verified the data was provided through an <a href="https://data.sfgov.org/terms-of-use">open license</a>, we created a <a href="https://github.com/whosonfirst/whosonfirst-sources/blob/master/sources/sfgov.json">new source</a>, <code>sfgov</code>, in our <a href="https://github.com/whosonfirst/whosonfirst-sources/tree/master/sources">sources repository</a> to give credit to the original author. This dataset was then downloaded to our desktop and added to a new QGIS document to compare with the existing shapes in WOF. Lucky for us, the SF OpenData is already in the WGS84 projection and does not need to be reprojected.</p> <p>Lastly, we need to add any properties that are retained from the source data file to our <a href="https://github.com/whosonfirst/whosonfirst-properties/blob/master/aliases/property_aliases.json">properties_alias.json file</a>. In San Francisco, for example, we have a <code>sfgov:name</code> field. In order to bring this property in, we will need to add it to the property_alias.json file (see file for formatting examples).</p> <h2 id="3-download-authoritative-neighbourhood-geometries">3: Download authoritative neighbourhood geometries</h2> <p>In this section, you will:</p> <ul> <li><strong>Download</strong> data</li> <li><strong>Open</strong> your data</li> <li><strong>Begin comparison</strong> with existing Who's On First records</li> </ul> <p><a href="https://camo.githubusercontent.com/6162a43208bc84d9a8a8df079030559b1fc0b2bb/68747470733a2f2f6d61707a656e2d6173736574732e73332e616d617a6f6e6177732e636f6d2f696d616765732f73662d6e65696768626f7572686f6f642d757064617465732f73665f6f70656e646174612e706e67" target="_blank"><img width="600" alt="SF OpenData neighbourhood data projected in QGIS" src="https://camo.githubusercontent.com/6162a43208bc84d9a8a8df079030559b1fc0b2bb/68747470733a2f2f6d61707a656e2d6173736574732e73332e616d617a6f6e6177732e636f6d2f696d616765732f73662d6e65696768626f7572686f6f642d757064617465732f73665f6f70656e646174612e706e67" data-canonical-src="https://mapzen-assets.s3.amazonaws.com/images/sf-neighbourhood-updates/sf_opendata.png" style="max-width:100%;"></a></p> <p><em>Image: SF OpenData neighbourhood data projected in QGIS.</em></p> <p>Once the data source was added to our source repository, the data was downloaded and placed into a new QGIS document (above) to compare to the geometries of WOF records. You can see the clean, non-overlapping geometries in the SF OpenData, unlike our existing WOF geometries (below).</p> <p><a href="https://camo.githubusercontent.com/5ea8c0b725090235b700fe26a0d98a01ba54e78c/68747470733a2f2f6d61707a656e2d6173736574732e73332e616d617a6f6e6177732e636f6d2f696d616765732f73662d6e65696768626f7572686f6f642d757064617465732f322e676966" target="_blank"><img width="600" alt="SF OpenData neighbourhood data projected in QGIS" src="https://camo.githubusercontent.com/5ea8c0b725090235b700fe26a0d98a01ba54e78c/68747470733a2f2f6d61707a656e2d6173736574732e73332e616d617a6f6e6177732e636f6d2f696d616765732f73662d6e65696768626f7572686f6f642d757064617465732f322e676966" data-canonical-src="https://mapzen-assets.s3.amazonaws.com/images/sf-neighbourhood-updates/2.gif" style="max-width:100%;"></a></p> <p><em>Image: WOF records projected in QGIS.</em></p> <p>Now that we have WOF records and data provided by the City of San Francisco, we can begin reconciling the two datasets. We will join the two datasets based on a common attribute; in this case the <code>wof:name</code> field from the WOF data was joined to the SF OpenData's <code>name</code> field. The join tool in QGIS can be found by navigating to the properties of the WOF .geojson layer and clicking the "Join" option (below).</p> <p><a href="https://camo.githubusercontent.com/c7552a1fbede388b8544957180aa576f82b793b8/68747470733a2f2f6d61707a656e2d6173736574732e73332e616d617a6f6e6177732e636f6d2f696d616765732f73662d6e65696768626f7572686f6f642d757064617465732f352e706e67" target="_blank"><img width="600" alt="Join Properties tab in QGIS" src="https://camo.githubusercontent.com/c7552a1fbede388b8544957180aa576f82b793b8/68747470733a2f2f6d61707a656e2d6173736574732e73332e616d617a6f6e6177732e636f6d2f696d616765732f73662d6e65696768626f7572686f6f642d757064617465732f352e706e67" data-canonical-src="https://mapzen-assets.s3.amazonaws.com/images/sf-neighbourhood-updates/5.png" style="max-width:100%;"></a></p> <p><em>Image: Join Properties tool in QGIS.</em></p> <p>In an ideal world, all WOF records would join cleanly to SF OpenData records, but that is typically not the case. This join method worked for the most part, but because the spellings are not identical between each of the attribute tables, this join needs to be verified and improved by hand. For example, QGIS's join tool did not join a value of <code>Haight Ashbury</code> to a value of <code>Haight-Ashbury</code> or a value of <code>Mission District</code> to a value of <code>Mission</code>. As described below, it's not a matter of which name field is "more correct", but a matter of importing additional names from your authoritative source while preserving the existing <code>wof:name</code> in a <code>eng_x_variant</code> name field.</p> <p>Alternately, we could perform this join based on location, instead of an attribute field. QGIS has functionality to perform a spatial join (<a href="http://www.qgistutorials.com/en/docs/performing_spatial_joins.html">some documentation here</a>), which would be helpful if our WOF geometries were geographically similar to our administrative data. However, because our geometries in San Francisco overlap substantially with the SF OpenData geometries, an attribute join is more likely to give us matching records between the two datasets (generally, neighbourhood names are unique in city). If you are unsure of which join is best for your locality, give them both a try and compare the results.</p> <p>Occasionally, Who's On First has duplicate records. Duplicate records <em>should</em> be noted in the <code>mz:note</code> property (with a "duplicate", "dupe" or "dup" value) or with a <code>1</code> value in the <code>mz:is_funky</code> or <code>mz:is_current</code> property. If you come across duplicate features when comparing and joining records, prefer the current record over the record with a <code>mz:note</code> of "duplicate", "dupe" or "dup" or a <code>1</code> value in the <code>mz:is_funky</code> or <code>mz:is_current</code> property.</p> <table> <thead> <tr> <th>Who's On First</th> <th>SF OpenData</th> <th>Note</th> </tr> </thead> <tbody> <tr> <td>Alamo Square</td> <td>Alamo Square</td> <td><em>in both, great! Let's import the new geometry!</em></td> </tr> <tr> <td>Anza Vista</td> <td>Anza Vista</td> <td><em>in both, great! Let's import the new geometry!</em></td> </tr> <tr> <td>Baja Noe</td> <td></td> <td><em>no match, no alternate name spelling, WOF only</em></td> </tr> <tr> <td>Bret Harte</td> <td><em>no WOF record, let's research.</em></td> <td></td> </tr> <tr> <td>Haight Ashbury</td> <td></td> <td><em>no name match, but does have alternate name: <code>Haight-Ashbury</code></em></td> </tr> <tr> <td>Cathedral Hill</td> <td>Cathedral Hill</td> <td><em>in both, great!</em></td> </tr></tbody></table> <p><em>Image: Comparison of WOF and SF OpenData name attributes.</em></p> <p>This method assigned <code>wof:id</code> values to each SF OpenData record that joined to a WOF record. After comparing, <strong>96</strong> of <strong>117</strong> SF OpenData records were assigned a <code>wof:id</code>. With the records that did not join based on the <code>name</code> field join, we will have to reconcile, adding the <code>wof:id</code> manually whenever possible. This is done easiest by reviewing each name in your WOF attributes table with  each name of your source data.</p> <p><a href="https://camo.githubusercontent.com/cf947b912a8adc9619141179960ad39ecd6a89be/68747470733a2f2f6d61707a656e2d6173736574732e73332e616d617a6f6e6177732e636f6d2f696d616765732f73662d6e65696768626f7572686f6f642d757064617465732f6a6f696e65645f617474726962757465732e706e67" target="_blank"><img width="300" alt="Attributes table after joining datasets" src="https://camo.githubusercontent.com/cf947b912a8adc9619141179960ad39ecd6a89be/68747470733a2f2f6d61707a656e2d6173736574732e73332e616d617a6f6e6177732e636f6d2f696d616765732f73662d6e65696768626f7572686f6f642d757064617465732f6a6f696e65645f617474726962757465732e706e67" data-canonical-src="https://mapzen-assets.s3.amazonaws.com/images/sf-neighbourhood-updates/joined_attributes.png" style="max-width:100%;"></a></p> <p><em>Image: SF OpenData attribute table after joining datasets. Records with NULL values need to be imported by hand.</em></p> <p>Examples of neighbourhoods that WOF did not have at the time of import are <code>Appearel City</code> and <code>Buena Vista</code> (meaning these records will need a new WOF ID). Since these neighbourhoods were not in the WOF database, we should consider importing them as new neighbourhood records.</p> <h2 id="4-reconciling-our-data-sources">4: Reconciling our data sources</h2> <p>In this section, you will:</p> <ul> <li><strong>Develop</strong> an action plan to modify data</li> <li>Note possible <strong>data modifications</strong> needed in our datasets</li> </ul> <p><strong>Remember</strong> - not all of the existing neighbourhood records matched to an SF OpenData geometry (96 new records were given existing IDs, but there were 165 existing neighbourhood records). This begs the question: <em>What should happen to the 69 leftover neighbourhood records?</em></p> <p>There are three options for the 69 leftover records:</p> <ul> <li><strong>Deprecate</strong> the record, as it was never a valid neighbourhood to begin with. Research can't verify this name or shape. Sometimes a neighbourhood falls out of common usage, or the error was an error.</li> <li><strong>Downgrade</strong> the record as a microhood and give it a <code>parented_by</code> value for the neighbourhood it falls within. People still use this name, but only the residents of those few city blocks.</li> <li><strong>Upgrade</strong> the neighbourhood records to a macrohood (see: <em>Sunset, Richmond, Downtown</em>).</li> </ul> <h3 id="modifying-sf-opendata">Modifying SF OpenData</h3> <p>Before importing the city-provided geometries, it is important to ensure the new neighbourhood boundaries will work in Who’s On First. While we can easily import the new neighbourhood geometries raw from our source (SF OpenData), we should "trust but verify" our data before the  import.</p> <p>The majority of geometries in the SF OpenData source were imported as-is, though four neighbourhood records in our San Francisco example were edited prior to import. Using our local knowledge and opinions, we adjusted these neighbourhood boundaries slightly.</p> <h3 id="modifying-wof-data">Modifying WOF Data</h3> <p>After our WOF shapes were added to a QGIS document (below), they were given a new integer attribute field titled "status" based on concordance with our administrative source data. The status values were color-coded to display the following options for each of WOF neighbourhood records:</p> <ul> <li><strong>1 - Neighbourhood.</strong> <em>Valid neighbourhood record. Both datasets agree this is a neighbourhood, probably needs a new shape and name.</em></li> <li><strong>2 - Reclassify up to macrohood.</strong> <em>Neighbourhood records that will become macrohood records.</em></li> <li><strong>3 - Reclassify down to microhoods.</strong> <em>Neighbourhood records that will be reclassified as microhood records. WOF records not in SF OpenData that are smaller than the surrounding neighbourhood should change placetypes to microhood.</em></li> <li><strong>4 - Reclassify down to microhoods... maybe.</strong> <em>Needs more investigation. Probably change placetype to a microhood.</em></li> <li><strong>5 - Deprecate neighbourhood.</strong> <em>Invalid record, should be "deprecated" and "superseded" in WOF. Everyone agrees this neighbourhood is an error.</em></li> </ul> <p><a href="https://camo.githubusercontent.com/52c02a452678e439dc309363c92f728e0941ddc2/68747470733a2f2f6d61707a656e2d6173736574732e73332e616d617a6f6e6177732e636f6d2f696d616765732f73662d6e65696768626f7572686f6f642d757064617465732f7265636f72645f7374617475732e706e67" target="_blank"><img width="600" alt="Assigning records' status in QGIS" src="https://camo.githubusercontent.com/52c02a452678e439dc309363c92f728e0941ddc2/68747470733a2f2f6d61707a656e2d6173736574732e73332e616d617a6f6e6177732e636f6d2f696d616765732f73662d6e65696768626f7572686f6f642d757064617465732f7265636f72645f7374617475732e706e67" data-canonical-src="https://mapzen-assets.s3.amazonaws.com/images/sf-neighbourhood-updates/record_status.png" style="max-width:100%;"></a></p> <p><em>Image: Developing an action plan in QGIS by assigning records' status in QGIS, reviewing WOF record matches with new SF OpenData source. Colors represent status value.</em></p> <p><strong>Congratulations!</strong> You have finished collecting and evaluating new neighbourhood shapes for WOF! In the next part of this tutorial, we'll prepare the data for import. But first, a well-deserved break.</p> <p>To finalize your work and prepare data for import, check out <a href="https://github.com/whosonfirst/whosonfirst-cookbook/blob/master/issue_workflows/sf_neighbourhood_updates_pt_2.md">part two</a>!</p> 
					</div>
				</div>
			</article>
		</div>
		<div class="col-lg-2 col-md-0 col-sm-0 col-xs-0"></div>
	</div>
</div>
			<!-- START footer.html -->

		</div>
		<footer>
			<nav class="navbar navbar-default navbar-bottom">
				<div class="container">
					<!-- Collect the nav links, forms, and other content for toggling -->
					<ul class="nav navbar-nav navbar-right whosonfirst-footer">
						<li><a href="/docs/contributing/" class="whosonfirst-nav-link whosonfirst-footer-nav-link">contributing</a></li>
						<li><a href="/docs/licenses/" class="whosonfirst-nav-link whosonfirst-footer-nav-link">license</a></li>
						<li><a rel="me" class="whosonfirst-nav-link whosonfirst-footer-nav-link" href="https://mapstodon.space/@whosonfirst">whosonfirst@mapstodon.space</a></li>
					</ul>
				</div>
			</nav>
		</footer>

		<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
		<script src="/javascript/jquery.min.js"></script>
		<!-- Include all compiled plugins (below), or include individual files as needed -->
		<script src="/javascript/bootstrap.min.js"></script>
		<script src="/javascript/mapzen.whosonfirst.home.js"></script>
		<script src="/javascript/mapzen.whosonfirst.subpage.js"></script>
		<!-- JavaScript for code styling from highlightpack.js -->
		<script src="/javascript/highlightpack.js"></script>
		<script>
		  try {
		  	hljs.initHighlightingOnLoad();
		  } catch (e) {
		  	console.log("HLJS", e);
		  }
		</script>
	</body>
</html>

<!-- END footer.html -->
